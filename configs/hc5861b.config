# ===========================================================
# OpenWrt 23.05.5 — 极路由3 Pro (HiWiFi HC5861B / R33)
#
# CPU:     MT7620A  单核 580MHz  mipsel_24kc
# RAM:     128MB DDR2
# Flash:   128MB NAND
# Switch:  RTL8367RB (千兆)
# WiFi:    MT7620A 内置 (2.4G) + MT7612EN PCIe (5G)
# USB:     USB 2.0
#
# 目标：Passwall2 + Hysteria2 透明代理
# ===========================================================

# -----------------------------------------------------------
# 1. Target + Device
# -----------------------------------------------------------
CONFIG_TARGET_ramips=y
CONFIG_TARGET_ramips_mt7620=y
CONFIG_TARGET_DEVICE_ramips_mt7620_DEVICE_hiwifi_hc5861b=y

# -----------------------------------------------------------
# 2. LuCI 界面
# -----------------------------------------------------------
CONFIG_PACKAGE_luci=y
CONFIG_PACKAGE_luci-base=y
CONFIG_PACKAGE_luci-compat=y
CONFIG_PACKAGE_luci-lib-ipkg=y
CONFIG_PACKAGE_luci-mod-admin-full=y
CONFIG_PACKAGE_luci-theme-bootstrap=y

# 中文
CONFIG_PACKAGE_luci-i18n-base-zh-cn=y
CONFIG_PACKAGE_luci-i18n-firewall-zh-cn=y
CONFIG_PACKAGE_luci-i18n-opkg-zh-cn=y

# -----------------------------------------------------------
# 3. ★★★ Passwall2 主程序
# -----------------------------------------------------------
CONFIG_PACKAGE_luci-app-passwall2=y
CONFIG_PACKAGE_luci-i18n-passwall2-zh-cn=y

# 透明代理（让 LAN 设备流量走代理的关键）
CONFIG_PACKAGE_luci-app-passwall2_Transparent_Proxy=y

# ★ Hysteria2 独立客户端（首选，最轻量）
CONFIG_PACKAGE_luci-app-passwall2_INCLUDE_Hysteria=y

# ★ SingBox 备选（支持更多协议，如也需 VLESS/Trojan 时用）
CONFIG_PACKAGE_luci-app-passwall2_INCLUDE_SingBox=y

# 负载均衡
CONFIG_PACKAGE_luci-app-passwall2_INCLUDE_Haproxy=y

# IPv6 NAT（IPv6 透明代理需要）
CONFIG_PACKAGE_luci-app-passwall2_INCLUDE_IPv6_Nat=y

# -----------------------------------------------------------
# 4. ★★★ 代理核心（显式声明，双重保险）
# -----------------------------------------------------------

# Hysteria v2 独立客户端
# 轻量，专为 Hysteria2 优化，内存占用比 sing-box 小
CONFIG_PACKAGE_hysteria=y

# SingBox — 需要开启 QUIC 才能支持 Hysteria2
CONFIG_PACKAGE_sing-box=y
CONFIG_SING_BOX_WITH_QUIC=y
CONFIG_SING_BOX_WITH_UTLS=y

# ★ 不需要 Xray（不支持 Hysteria2，节省 ~20MB Flash + RAM）
# CONFIG_PACKAGE_xray-core is not set

# -----------------------------------------------------------
# 5. ★★★ 透明代理运行依赖
# -----------------------------------------------------------

# DNS 分流（国内直连 DNS + 国外走代理 DNS）
CONFIG_PACKAGE_chinadns-ng=y
CONFIG_PACKAGE_dns2socks=y
CONFIG_PACKAGE_dns2tcp=y

# ★ TPROXY 透明代理（Hysteria2 是 UDP 协议，必须 TPROXY）
CONFIG_PACKAGE_ipt2socks=y
CONFIG_PACKAGE_iptables-mod-tproxy=y
CONFIG_PACKAGE_kmod-ipt-tproxy=y

# IPv6 NAT
CONFIG_PACKAGE_ip6tables-mod-nat=y

# IP 路由工具（策略路由必需）
CONFIG_PACKAGE_ipset=y
CONFIG_PACKAGE_ip-full=y

# 辅助工具
CONFIG_PACKAGE_microsocks=y
CONFIG_PACKAGE_tcping=y
CONFIG_PACKAGE_haproxy=y
CONFIG_PACKAGE_coreutils=y
CONFIG_PACKAGE_coreutils-base64=y
CONFIG_PACKAGE_coreutils-nohup=y
CONFIG_PACKAGE_curl=y
CONFIG_PACKAGE_wget-ssl=y
CONFIG_PACKAGE_ca-certificates=y
CONFIG_PACKAGE_resolveip=y
CONFIG_PACKAGE_unzip=y

# -----------------------------------------------------------
# 6. ★ 内存优化（128MB RAM 跑代理很紧张）
# -----------------------------------------------------------
# zram：压缩内存交换，有效扩展可用 RAM
CONFIG_PACKAGE_zram-swap=y
CONFIG_PACKAGE_kmod-zram=y
CONFIG_PACKAGE_kmod-lib-lzo=y
CONFIG_PACKAGE_kmod-lib-lz4=y

# -----------------------------------------------------------
# 7. IPv6
# -----------------------------------------------------------
CONFIG_PACKAGE_ipv6helper=y
CONFIG_PACKAGE_ip6tables=y
CONFIG_PACKAGE_odhcp6c=y
CONFIG_PACKAGE_odhcpd-ipv6only=y

# -----------------------------------------------------------
# 8. 无线驱动
# -----------------------------------------------------------
# MT7620A 2.4G — 内置于 SoC，驱动由 target 自动选择
# （rt2800-soc，无需手动指定）

# MT7612EN 5G — PCIe 接口，需要 mt76x2 驱动
CONFIG_PACKAGE_kmod-mt76x2=y

# WPA2 加密
CONFIG_PACKAGE_wpad-basic-mbedtls=y

# -----------------------------------------------------------
# 9. USB 2.0 存储（可挂载 U 盘）
# -----------------------------------------------------------
CONFIG_PACKAGE_kmod-usb-core=y
CONFIG_PACKAGE_kmod-usb2=y
CONFIG_PACKAGE_kmod-usb-ohci=y
CONFIG_PACKAGE_kmod-usb-storage=y
CONFIG_PACKAGE_kmod-fs-ext4=y
CONFIG_PACKAGE_kmod-fs-vfat=y
CONFIG_PACKAGE_block-mount=y

# -----------------------------------------------------------
# 10. 实用工具（精简，节省内存）
# -----------------------------------------------------------
CONFIG_PACKAGE_htop=y
CONFIG_PACKAGE_nano=y

# -----------------------------------------------------------
# 11. 附加 LuCI 应用
# -----------------------------------------------------------
# UPnP
CONFIG_PACKAGE_luci-app-upnp=y
CONFIG_PACKAGE_luci-i18n-upnp-zh-cn=y
